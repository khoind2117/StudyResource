@using StudyResource.ViewModels.Document
@model DocumentDetailViewModel

@{
    ViewData["Title"] = "Detail";
}

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <title>@ViewData["Title"] - StudyResource</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="icon" href="~/etrain-master/img/favicon.png">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="~/etrain-master/css/bootstrap.min.css">
    <!-- animate CSS -->
    <link rel="stylesheet" href="~/etrain-master/css/animate.css">
    <!-- owl carousel CSS -->
    <link rel="stylesheet" href="~/etrain-master/css/owl.carousel.min.css">
    <!-- themify CSS -->
    <link rel="stylesheet" href="~/etrain-master/css/themify-icons.css">
    <!-- flaticon CSS -->
    <link rel="stylesheet" href="~/etrain-master/css/flaticon.css">
    <!-- font awesome CSS -->
    <link rel="stylesheet" href="~/etrain-master/css/magnific-popup.css">
    <!-- swiper CSS -->
    <link rel="stylesheet" href="~/etrain-master/css/slick.css">
    <!-- style CSS -->
    <link rel="stylesheet" href="~/etrain-master/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.js"></script>


    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <style> 
        #comments-section 
        { 
            max-height: 400px; overflow-y: auto; 
        }

        .delete-comment {
            cursor: pointer;
            font-size: 1.2em; 
            margin-left: 10px;
        }

    </style> 

</head>
<body>
    <section class="feature_part">
        <div class="container my-5">
            @if (TempData["Message"] != null)
            {
                <div class="alert alert-info" role="alert">
                    @TempData["Message"]
                </div>
            }

            <div class="row">
                <div class="col-md-4 text-center">
                    @{
                        var downloadLink = $"https://drive.google.com/uc?export=download&id={Model.GoogleDriveId}";
                        var thumbnailLink = $"https://drive.google.com/thumbnail?sz=w320&id={Model.GoogleDriveId}";
                    }
                    <a href="@thumbnailLink" target="_blank">
                        <img referrerPolicy="no-referrer" src="@thumbnailLink" alt="Document" class="img-fluid mb-3" />
                    </a>
                    <h3 class="" style="color: #0c2e60">@Model.Title</h3>
                    <p>@Model.DocumentType?.Name</p></br>
                    <a class="btn btn_4 btn-sm" target="_blank" href="@Url.Action("Ebook", "Document", new { area = "", id = Model.Id })">Đọc</a>
                    <a href="@downloadLink" class="btn btn_4 btn-sm">Tải</a>
                    <form method="post" action="@Url.Action("AddToFavorite", "Favorite")" style="display:inline;">
                        <input type="hidden" name="documentId" value="@Model.Id" />
                        <button type="submit" class="btn btn_4 btn-sm">Lưu</button>
                    </form>
                    @* <a href="@Url.Action("AddToFavorite", "Favorite")"" class="btn btn_4 btn-sm">Lưu</a> *@
                </div>
                <div class="col-md-8">
                    <div class="book-set-filter">
                        <ul class="nav nav-tabs">
                            <li class="nav-item">
                                <a class="nav-link active" data-toggle="tab" href="#tab-info"><h4>Thông tin</h4></a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" data-toggle="tab" href="#tab-comments"><h4>Đánh giá</h4></a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" data-toggle="tab" href="#tab-notes"><h4>Ghi chú</h4></a>
                            </li>
                        </ul>
                        <div class="tab-content mt-4">
                            <div id="tab-info" class="tab-pane fade show active">
                                <p>@Model.Description</p>
                            </div>
                            <div id="tab-comments" class="tab-pane fade">
                                <form id="commentForm" method="post" action="@Url.Action("SubmitComment", "Document")">
                                    <div class="form-group">
                                        <label for="comment">Bình luận:</label>
                                        <textarea id="comment" name="Comment" class="form-control" required></textarea>
                                        <input type="hidden" name="GoogleDriveId" value="@Model.GoogleDriveId" />
                                    </div>
                                    <button type="submit" class="genric-btn success-border circle arrow">Gửi</button>
                                </form>
                                <div id="comments-section" class="mt-4">
                                    <ul class="list-unstyled">
                                        @foreach (var comment in Model.UserComments)
                                        {
                                            <li class="media my-3" data-comment-id="@comment.Id" style="position: relative;">
                                                <div class="media-body">
                                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                                        <div>
                                                            <h5>@comment.Username <small class="text-muted">(@comment.CommentDate.ToShortDateString())</small></h5>
                                                            <p>@comment.Comment</p>
                                                        </div>
                                                        <form method="post" action="@Url.Action("DeleteComment", "Document")" style="display:inline;">
                                                            <input type="hidden" name="id" value="@comment.Id" />
                                                            <button type="submit" style="border: none" class="delete-comment text-danger" title="Xóa bình luận">
                                                                <i class="fas fa-trash-alt"></i>
                                                            </button>
                                                        </form>
                                                    </div>
                                                </div>
                                            </li>

                                        }
                                    </ul>
                                </div>
                            </div>

                            <div id="tab-notes" class="tab-pane fade">
                                <p>Ghi chú</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>


    <!-- jquery plugins here-->
    <!-- jquery -->
    <script src="~/etrain-master/js/jquery-1.12.1.min.js"></script>
    <!-- popper js -->
    <script src="~/etrain-master/js/popper.min.js"></script>
    <!-- bootstrap js -->
    <script src="~/etrain-master/js/bootstrap.min.js"></script>
    <!-- easing js -->
    <script src="~/etrain-master/js/jquery.magnific-popup.js"></script>
    <!-- swiper js -->
    <script src="~/etrain-master/js/swiper.min.js"></script>
    <!-- masonry js -->
    <script src="~/etrain-master/js/masonry.pkgd.js"></script>
    <!-- particles js -->
    <script src="~/etrain-master/js/owl.carousel.min.js"></script>
    <script src="~/etrain-master/js/jquery.nice-select.min.js"></script>
    <!-- slick js -->
    <script src="~/etrain-master/js/slick.min.js"></script>
    <script src="~/etrain-master/js/jquery.counterup.min.js"></script>
    <script src="~/etrain-master/js/waypoints.min.js"></script>
    <!-- custom js -->
    <script src="~/etrain-master/js/custom.js"></script>
 
</body>